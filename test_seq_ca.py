
from tempfile import gettempdir, NamedTemporaryFile
import biotite.structure.io.pdb as pdb
import biotite.database.rcsb as rcsb
import numpy as np
from scipy.spatial.distance import pdist, squareform


def __extract_coordinates__(file: str) -> tuple[
    tuple[float, float, float], tuple[float | None, float | None, float | None]]:
    ca_coords = []
    coords_with_breaks = []
    previous_residue_sequence_number = None
    max_residue_number = 0  # Track the highest residue number encountered in the file

    for line in file.splitlines():
        if line.startswith('ATOM'):
            atom_type = line[12:16].strip()
            # Adjust indices for your specific PDB format if needed
            current_residue_sequence_number = int(line[22:26].strip())
            # Track the highest residue number encountered
            if current_residue_sequence_number > max_residue_number:
                max_residue_number = current_residue_sequence_number

            if atom_type == 'CA':
                # If we have a previous residue and the current residue is not the immediate next,
                # fill the gap with None
                if (previous_residue_sequence_number is not None and
                        current_residue_sequence_number > previous_residue_sequence_number + 1):
                    for _ in range(previous_residue_sequence_number + 1, current_residue_sequence_number):
                        coords_with_breaks.append((None, None, None))

                x = float(line[30:38])
                y = float(line[38:46])
                z = float(line[46:54])

                ca_coords.append((x, y, z))
                coords_with_breaks.append((x, y, z))
                previous_residue_sequence_number = current_residue_sequence_number

    # After processing all lines, use the last encountered residue number as final_residue_number
    # If the last CA residue number is not equal to the max_residue_number, fill with None
    if (previous_residue_sequence_number is not None and
            max_residue_number > previous_residue_sequence_number):
        for _ in range(previous_residue_sequence_number + 1, max_residue_number + 1):
            coords_with_breaks.append((None, None, None))

    return tuple(ca_coords), tuple(coords_with_breaks)


def improved_distances_calculation(coords, coords_with_breaks):
    # Calculate base distances from coords without breaks
    distances_1d = pdist(coords).astype(np.float16)
    distances_base = squareform(distances_1d)  # 2d array

    n = distances_base.shape[0]

    # 2. Wyliczyć medianę z diagonali +1 (wartości distances_base[i, i+1])
    # Sprawdzamy tylko elementy powyżej głównej przekątnej (pierwsza nadprzekątna).
    if n > 1:
        diag_plus_one = distances_base[np.arange(n - 1), np.arange(1, n)]
        median_diag = np.nanmedian(diag_plus_one)
    else:
        # Jeżeli jest tylko jeden punkt, medianę ustawiamy np. na 0 lub np.nan
        median_diag = 0.0

    # Create array with NaNs for missing coordinates
    n_full = len(coords_with_breaks)
    distances_with_nans = np.full((n_full, n_full), np.nan, dtype=np.float16)

    # Create mask of valid coordinates
    valid_indices = [i for i, coord in enumerate(coords_with_breaks) if coord[0] is not None]

    # Fill in distances for valid coordinates
    for i, vi in enumerate(valid_indices):
        for j, vj in enumerate(valid_indices):
            distances_with_nans[vi, vj] = distances_base[i, j]

    # Fill in median_diag values around NaN diagonal elements
    # for i in range(n_full):
    #     if np.isnan(distances_with_nans[i, i]):
    #         distances_with_nans[i, i] = 0.0  # Set diagonal to 0
    #         # Set adjacent cells to median_diag if they exist
    #         if i > 0:  # Left
    #             distances_with_nans[i, i - 1] = median_diag
    #             distances_with_nans[i - 1, i] = median_diag  # Symmetric
    #         if i < n_full - 1:  # Right
    #             distances_with_nans[i, i + 1] = median_diag
    #             distances_with_nans[i + 1, i] = median_diag  # Symmetric

    return distances_with_nans


def __process_pdbs__(data: str):

    data_ = __extract_coordinates__(data)
    coords, coords_with_breaks = data_

    distances = improved_distances_calculation(coords, coords_with_breaks)
    np.savetxt("111dists.csv", distances, delimiter=",")
    print(distances)

input = """
ATOM      1  N   THR P  49    157.5729144.7042168.9863 1.00086.036           N 
ATOM      2  CA  THR P  49    157.5779145.5472170.1763 1.00086.036           C 
ATOM      3  C   THR P  49    158.4599146.7722169.9563 1.00086.036           C 
ATOM      4  O   THR P  49    159.5039146.6902169.3093 1.00086.036           O 
ATOM      5  CB  THR P  49    158.0699144.7722171.4133 1.00086.036           C 
ATOM      6 OG1  THR P  49    157.2149143.6462171.6473 1.00086.036           O 
ATOM      7 CG2  THR P  49    158.0739145.6652172.6463 1.00086.036           C 
ATOM      8  HA  THR P  49    156.6739145.8522170.3513 1.00086.036           H 
ATOM      9  HB  THR P  49    158.9759144.4612171.2583 1.00086.036           H 
ATOM     10 HG1  THR P  49    157.1549143.1802170.9523 1.00086.036           H 
ATOM     11 HG21 THR P  49    158.0709145.1202173.4483 1.00086.036           H 
ATOM     12 HG22 THR P  49    158.8649146.2272172.6523 1.00086.036           H 
ATOM     13 HG23 THR P  49    157.2859146.2292172.6493 1.00086.036           H 
ATOM     14  N   LYS P  50    158.0319147.9072170.5013 1.00082.094           N 
ATOM     15  CA  LYS P  50    158.7339149.1682170.3123 1.00082.094           C 
ATOM     16  C   LYS P  50    158.1669150.2122171.2673 1.00082.094           C 
ATOM     17  O   LYS P  50    157.0869150.0042171.8363 1.00082.094           O 
ATOM     18  CB  LYS P  50    158.6149149.6322168.8593 1.00082.094           C 
ATOM     19  CG  LYS P  50    157.1849149.7702168.3643 1.00082.094           C 
ATOM     20  CD  LYS P  50    157.1419150.1062166.8893 1.00082.094           C 
ATOM     21  CE  LYS P  50    155.7219150.0782166.3583 1.00082.094           C 
ATOM     22  NZ  LYS P  50    155.6789150.2912164.8883 1.00082.094           N 
ATOM     23  H   LYS P  50    157.3329147.9712170.9953 1.00082.094           H 
ATOM     24  HA  LYS P  50    159.6709149.0322170.5143 1.00082.094           H 
ATOM     25 HB2  LYS P  50    159.0399150.4962168.7623 1.00082.094           H 
ATOM     26 HB3  LYS P  50    159.0619148.9862168.2913 1.00082.094           H 
ATOM     27 HG2  LYS P  50    156.7119148.9342168.4933 1.00082.094           H 
ATOM     28 HG3  LYS P  50    156.7459150.4852168.8503 1.00082.094           H 
ATOM     29 HD2  LYS P  50    157.4999150.9972166.7543 1.00082.094           H 
ATOM     30 HD3  LYS P  50    157.6639149.4552166.3973 1.00082.094           H 
ATOM     31 HE2  LYS P  50    155.3269149.2142166.5513 1.00082.094           H 
ATOM     32 HE3  LYS P  50    155.2089150.7832166.7823 1.00082.094           H 
ATOM     33 HZ1  LYS P  50    154.8459150.1932164.5923 1.00082.094           H 
ATOM     34 HZ2  LYS P  50    155.9629151.1112164.6923 1.00082.094           H 
ATOM     35 HZ3  LYS P  50    156.2019149.6992164.4813 1.00082.094           H 
ATOM     36  N   PRO P  51    158.8549151.3412171.4793 1.00076.896           N 
ATOM     37  CA  PRO P  51    158.3439152.3402172.4273 1.00076.896           C 
ATOM     38  C   PRO P  51    157.0589153.0002171.9633 1.00076.896           C 
ATOM     39  O   PRO P  51    156.5729152.7302170.8603 1.00076.896           O 
ATOM     40  CB  PRO P  51    159.4839153.3622172.5123 1.00076.896           C 
ATOM     41  CG  PRO P  51    160.6679152.6972171.9323 1.00076.896           C 
ATOM     42  CD  PRO P  51    160.1519151.7472170.9173 1.00076.896           C 
ATOM     43  HA  PRO P  51    158.2049151.9402173.2983 1.00076.896           H 
ATOM     44 HB2  PRO P  51    159.2429154.1412171.9923 1.00076.896           H 
ATOM     45 HB3  PRO P  51    159.6419153.5992173.4373 1.00076.896           H 
ATOM     46 HG2  PRO P  51    161.2379153.3612171.5163 1.00076.896           H 
ATOM     47 HG3  PRO P  51    161.1449152.2232172.6293 1.00076.896           H 
ATOM     48 HD2  PRO P  51    160.0249152.1972170.0683 1.00076.896           H 
ATOM     49 HD3  PRO P  51    160.7529150.9922170.8363 1.00076.896           H 
ATOM     50  N   SER P  52    156.5049153.8722172.8013 1.00074.571           N 
ATOM     51  CA  SER P  52    155.3079154.6372172.4553 1.00074.571           C 
ATOM     52  C   SER P  52    155.6679155.9752171.8173 1.00074.571           C 
ATOM     53  O   SER P  52    155.2459157.0412172.2623 1.00074.571           O 
ATOM     54  CB  SER P  52    154.4519154.8382173.6983 1.00074.571           C 
ATOM     55  OG  SER P  52    154.1459153.5972174.3083 1.00074.571           O 
ATOM     56  H   SER P  52    156.8069154.0402173.5873 1.00074.571           H 
ATOM     57  HA  SER P  52    154.7849154.1352171.8133 1.00074.571           H 
ATOM     58 HB2  SER P  52    154.9389155.3902174.3293 1.00074.571           H 
ATOM     59 HB3  SER P  52    153.6249155.2762173.4433 1.00074.571           H 
ATOM     60  HG  SER P  52    153.7879153.7282175.0563 1.00074.571           H 
ATOM     61  N   TYR P  53    156.4709155.9172170.7593 1.00075.627           N 
ATOM     62  CA  TYR P  53    156.7199157.0722169.9063 1.00075.627           C 
ATOM     63  C   TYR P  53    157.3269156.6012168.5923 1.00075.627           C 
ATOM     64  O   TYR P  53    158.3309155.8842168.5883 1.00075.627           O 
ATOM     65  CB  TYR P  53    157.6229158.0882170.6033 1.00075.627           C 
ATOM     66  CG  TYR P  53    158.6799157.4932171.5043 1.00075.627           C 
ATOM     67 CD1  TYR P  53    158.5079157.4662172.8803 1.00075.627           C 
ATOM     68 CD2  TYR P  53    159.8549156.9712170.9813 1.00075.627           C 
ATOM     69 CE1  TYR P  53    159.4709156.9322173.7093 1.00075.627           C 
ATOM     70 CE2  TYR P  53    160.8239156.4362171.8053 1.00075.627           C 
ATOM     71  CZ  TYR P  53    160.6249156.4192173.1683 1.00075.627           C 
ATOM     72  OH  TYR P  53    161.5859155.8842173.9923 1.00075.627           O 
ATOM     73  H   TYR P  53    156.8869155.2082170.5103 1.00075.627           H 
ATOM     74  HA  TYR P  53    155.8789157.5092169.7073 1.00075.627           H 
ATOM     75 HB2  TYR P  53    158.0739158.6122169.9253 1.00075.627           H 
ATOM     76 HB3  TYR P  53    157.0679158.6652171.1503 1.00075.627           H 
ATOM     77 HD1  TYR P  53    157.7289157.8142173.2473 1.00075.627           H 
ATOM     78 HD2  TYR P  53    159.9889156.9812170.0613 1.00075.627           H 
ATOM     79 HE1  TYR P  53    159.3429156.9192174.6293 1.00075.627           H 
ATOM     80 HE2  TYR P  53    161.6049156.0852171.4433 1.00075.627           H 
ATOM     81  HH  TYR P  53    162.2169155.5762173.5313 1.00075.627           H 
ATOM     82  N   PHE P  54    156.7289156.9982167.4723 1.00081.034           N 
ATOM     83  CA  PHE P  54    157.0979156.4332166.1843 1.00081.034           C 
ATOM     84  C   PHE P  54    156.5789157.3402165.0793 1.00081.034           C 
ATOM     85  O   PHE P  54    155.4319157.7912165.1273 1.00081.034           O 
ATOM     86  CB  PHE P  54    156.5269155.0182166.0323 1.00081.034           C 
ATOM     87  CG  PHE P  54    157.2489154.1712165.0293 1.00081.034           C 
ATOM     88 CD1  PHE P  54    158.4819153.6212165.3323 1.00081.034           C 
ATOM     89 CD2  PHE P  54    156.6869153.9042163.7923 1.00081.034           C 
ATOM     90 CE1  PHE P  54    159.1479152.8322164.4173 1.00081.034           C 
ATOM     91 CE2  PHE P  54    157.3499153.1152162.8723 1.00081.034           C 
ATOM     92  CZ  PHE P  54    158.5819152.5782163.1863 1.00081.034           C 
ATOM     93  H   PHE P  54    156.1109157.5942167.4343 1.00081.034           H 
ATOM     94  HA  PHE P  54    158.0629156.3832166.1163 1.00081.034           H 
ATOM     95 HB2  PHE P  54    156.5819154.5642166.8863 1.00081.034           H 
ATOM     96 HB3  PHE P  54    155.6009155.0822165.7543 1.00081.034           H 
ATOM     97 HD1  PHE P  54    158.8669153.7902166.1613 1.00081.034           H 
ATOM     98 HD2  PHE P  54    155.8569154.2632163.5753 1.00081.034           H 
ATOM     99 HE1  PHE P  54    159.9779152.4712164.6303 1.00081.034           H 
ATOM    100 HE2  PHE P  54    156.9639152.9462162.0433 1.00081.034           H 
ATOM    101  HZ  PHE P  54    159.0299152.0462162.5703 1.00081.034           H 
ATOM    102  N   GLN P  55    157.4299157.6042164.0913 1.00080.350           N 
ATOM    103  CA  GLN P  55    157.0439158.4242162.9523 1.00080.350           C 
ATOM    104  C   GLN P  55    156.1409157.6252162.0203 1.00080.350           C 
ATOM    105  O   GLN P  55    156.4219156.4622161.7163 1.00080.350           O 
ATOM    106  CB  GLN P  55    158.2839158.9082162.2013 1.00080.350           C 
ATOM    107  CG  GLN P  55    158.0159159.9362161.1093 1.00080.350           C 
ATOM    108  CD  GLN P  55    157.5529161.2752161.6543 1.00080.350           C 
ATOM    109 OE1  GLN P  55    157.4339161.4592162.8653 1.00080.350           O 
ATOM    110 NE2  GLN P  55    157.2919162.2192160.7583 1.00080.350           N 
ATOM    111  H   GLN P  55    158.2409157.3192164.0593 1.00080.350           H 
ATOM    112  HA  GLN P  55    156.5479159.1942163.2673 1.00080.350           H 
ATOM    113 HB2  GLN P  55    158.8939159.3102162.8383 1.00080.350           H 
ATOM    114 HB3  GLN P  55    158.7059158.1422161.7833 1.00080.350           H 
ATOM    115 HG2  GLN P  55    158.8359160.0862160.6133 1.00080.350           H 
ATOM    116 HG3  GLN P  55    157.3299159.6002160.5133 1.00080.350           H 
ATOM    117 HE21 GLN P  55    157.3879162.0542159.9193 1.00080.350           H 
ATOM    118 HE22 GLN P  55    157.0269162.9952161.0153 1.00080.350           H 
ATOM    119  N   ALA P  56    155.0599158.2512161.5703 1.00081.236           N 
ATOM    120  CA  ALA P  56    154.1359157.6142160.6423 1.00081.236           C 
ATOM    121  C   ALA P  56    154.6559157.7162159.2133 1.00081.236           C 
ATOM    122  O   ALA P  56    154.8209158.8132158.6803 1.00081.236           O 
ATOM    123  CB  ALA P  56    152.7619158.2432160.7483 1.00081.236           C 
ATOM    124  H   ALA P  56    154.8369159.0512161.7913 1.00081.236           H 
ATOM    125  HA  ALA P  56    154.0539156.6752160.8673 1.00081.236           H 
ATOM    126 HB1  ALA P  56    152.1609157.7922160.1363 1.00081.236           H 
ATOM    127 HB2  ALA P  56    152.4429158.1472161.6593 1.00081.236           H 
ATOM    128 HB3  ALA P  56    152.8289159.1822160.5173 1.00081.236           H 
ATOM    129  N   GLU P  82    180.9969185.4392165.4653 1.00080.439           N 
ATOM    130  CA  GLU P  82    182.3909185.2802165.8633 1.00080.439           C 
ATOM    131  C   GLU P  82    182.5729183.9982166.6683 1.00080.439           C 
ATOM    132  O   GLU P  82    181.6269183.2332166.8583 1.00080.439           O 
ATOM    133  CB  GLU P  82    182.8589186.4882166.6803 1.00080.439           C 
ATOM    134  CG  GLU P  82    182.7189187.8242165.9653 1.00080.439           C 
ATOM    135  CD  GLU P  82    183.6189187.9392164.7503 1.00080.439           C 
ATOM    136 OE1  GLU P  82    184.5059187.0772164.5793 1.00080.439           O 
ATOM    137 OE2  GLU P  82    183.4399188.8932163.9643 1.00080.439           O 
ATOM    138  HA  GLU P  82    182.9429185.2142165.0693 1.00080.439           H 
ATOM    139 HB2  GLU P  82    182.3359186.5332167.4953 1.00080.439           H 
ATOM    140 HB3  GLU P  82    183.7969186.3742166.9003 1.00080.439           H 
ATOM    141 HG2  GLU P  82    181.8019187.9362165.6733 1.00080.439           H 
ATOM    142 HG3  GLU P  82    182.9569188.5352166.5803 1.00080.439           H 
ATOM    143  N   GLN P  83    183.7989183.7712167.1373 1.00076.531           N 
ATOM    144  CA  GLN P  83    184.1169182.5862167.9223 1.00076.531           C 
ATOM    145  C   GLN P  83    183.9439182.8102169.4163 1.00076.531           C 
ATOM    146  O   GLN P  83    183.6119181.8642170.1403 1.00076.531           O 
ATOM    147  CB  GLN P  83    185.5519182.1382167.6383 1.00076.531           C 
ATOM    148  CG  GLN P  83    185.8019181.7102166.1983 1.00076.531           C 
ATOM    149  CD  GLN P  83    185.0969180.4232165.8403 1.00076.531           C 
ATOM    150 OE1  GLN P  83    184.4959179.7752166.6933 1.00076.531           O 
ATOM    151 NE2  GLN P  83    185.1689180.0422164.5723 1.00076.531           N 
ATOM    152  H   GLN P  83    184.4669184.2962167.0153 1.00076.531           H 
ATOM    153  HA  GLN P  83    183.5239181.8672167.6623 1.00076.531           H 
ATOM    154 HB2  GLN P  83    186.1489182.8742167.8363 1.00076.531           H 
ATOM    155 HB3  GLN P  83    185.7569181.3842168.2123 1.00076.531           H 
ATOM    156 HG2  GLN P  83    185.4869182.4032165.5983 1.00076.531           H 
ATOM    157 HG3  GLN P  83    186.7499181.5652166.0703 1.00076.531           H 
ATOM    158 HE21 GLN P  83    185.5999180.5222164.0043 1.00076.531           H 
ATOM    159 HE22 GLN P  83    184.7839179.3152164.3193 1.00076.531           H 
ATOM    160  N   VAL P  84    184.1609184.0332169.8913 1.00073.856           N 
ATOM    161  CA  VAL P  84    184.0019184.3642171.3023 1.00073.856           C 
ATOM    162  C   VAL P  84    182.6059184.9252171.5243 1.00073.856           C 
ATOM    163  O   VAL P  84    182.1669185.8352170.8103 1.00073.856           O 
ATOM    164  CB  VAL P  84    185.0799185.3602171.7683 1.00073.856           C 
ATOM    165 CG1  VAL P  84    186.4569184.7942171.5403 1.00073.856           C 
ATOM    166 CG2  VAL P  84    184.9419186.7072171.0763 1.00073.856           C 
ATOM    167  H   VAL P  84    184.4029184.6932169.4013 1.00073.856           H 
ATOM    168  HA  VAL P  84    184.0899183.5612171.8353 1.00073.856           H 
ATOM    169  HB  VAL P  84    184.9749185.5102172.7193 1.00073.856           H 
ATOM    170 HG11 VAL P  84    187.1049185.3732171.9693 1.00073.856           H 
ATOM    171 HG12 VAL P  84    186.4969183.9072171.9263 1.00073.856           H 
ATOM    172 HG13 VAL P  84    186.6249184.7522170.5873 1.00073.856           H 
ATOM    173 HG21 VAL P  84    185.7589187.2092171.2223 1.00073.856           H 
ATOM    174 HG22 VAL P  84    184.8039186.5782170.1283 1.00073.856           H 
ATOM    175 HG23 VAL P  84    184.1909187.1832171.4603 1.00073.856           H 
ATOM    176  N   GLU P  85    181.9009184.3722172.5053 1.00074.106           N 
ATOM    177  CA  GLU P  85    180.5829184.8682172.8583 1.00074.106           C 
ATOM    178  C   GLU P  85    180.7069186.1532173.6653 1.00074.106           C 
ATOM    179  O   GLU P  85    181.6729186.3602174.4033 1.00074.106           O 
ATOM    180  CB  GLU P  85    179.8079183.8232173.6603 1.00074.106           C 
ATOM    181  CG  GLU P  85    179.6069182.4972172.9393 1.00074.106           C 
ATOM    182  CD  GLU P  85    178.7439182.6232171.6963 1.00074.106           C 
ATOM    183 OE1  GLU P  85    178.0859183.6712171.5273 1.00074.106           O 
ATOM    184 OE2  GLU P  85    178.7239181.6712170.8883 1.00074.106           O 
ATOM    185  H   GLU P  85    182.1639183.7072172.9793 1.00074.106           H 
ATOM    186  HA  GLU P  85    180.0889185.0672172.0503 1.00074.106           H 
ATOM    187 HB2  GLU P  85    180.2939183.6422174.4783 1.00074.106           H 
ATOM    188 HB3  GLU P  85    178.9319184.1792173.8733 1.00074.106           H 
ATOM    189 HG2  GLU P  85    180.4709182.1482172.6703 1.00074.106           H 
ATOM    190 HG3  GLU P  85    179.1729181.8752173.5433 1.00074.106           H 
ATOM    191  N   GLY P  86    179.7149187.0202173.5143 1.00071.387           N 
ATOM    192  CA  GLY P  86    179.7249188.2982174.1843 1.00071.387           C 
ATOM    193  C   GLY P  86    179.6479188.1632175.6913 1.00071.387           C 
ATOM    194  O   GLY P  86    179.5649187.0762176.2623 1.00071.387           O 
ATOM    195  H   GLY P  86    179.0229186.8862173.0233 1.00071.387           H 
ATOM    196 HA2  GLY P  86    180.5439188.7682173.9663 1.00071.387           H 
ATOM    197 HA3  GLY P  86    178.9739188.8292173.8843 1.00071.387           H 
ATOM    198  N   PHE P  87    179.6749189.3202176.3463 1.00069.230           N 
ATOM    199  CA  PHE P  87    179.6389189.3892177.8003 1.00069.230           C 
ATOM    200  C   PHE P  87    178.2199189.3952178.3503 1.00069.230           C 
ATOM    201  O   PHE P  87    177.9899188.8792179.4503 1.00069.230           O 
ATOM    202  CB  PHE P  87    180.3889190.6372178.2713 1.00069.230           C 
ATOM    203  CG  PHE P  87    180.2659190.9092179.7393 1.00069.230           C 
ATOM    204 CD1  PHE P  87    180.5379189.9222180.6693 1.00069.230           C 
ATOM    205 CD2  PHE P  87    179.8999192.1622180.1903 1.00069.230           C 
ATOM    206 CE1  PHE P  87    180.4279190.1782182.0173 1.00069.230           C 
ATOM    207 CE2  PHE P  87    179.7919192.4232181.5353 1.00069.230           C 
ATOM    208  CZ  PHE P  87    180.0549191.4312182.4503 1.00069.230           C 
ATOM    209  H   PHE P  87    179.7149190.0882175.9653 1.00069.230           H 
ATOM    210  HA  PHE P  87    180.0949188.6152178.1613 1.00069.230           H 
ATOM    211 HB2  PHE P  87    181.3299190.5272178.0693 1.00069.230           H 
ATOM    212 HB3  PHE P  87    180.0389191.4052177.7983 1.00069.230           H 
ATOM    213 HD1  PHE P  87    180.7859189.0752180.3803 1.00069.230           H 
ATOM    214 HD2  PHE P  87    179.7189192.8362179.5763 1.00069.230           H 
ATOM    215 HE1  PHE P  87    180.6079189.5072182.6333 1.00069.230           H 
ATOM    216 HE2  PHE P  87    179.5419193.2692181.8263 1.00069.230           H 
ATOM    217  HZ  PHE P  87    179.9829191.6072183.3593 1.00069.230           H 
ATOM    218  N   ILE P  88    177.2679189.9532177.6073 1.00068.745           N 
ATOM    219  CA  ILE P  88    175.8749190.0492178.0263 1.00068.745           C 
ATOM    220  C   ILE P  88    175.0289189.2412177.0543 1.00068.745           C 
ATOM    221  O   ILE P  88    175.1599189.3922175.8343 1.00068.745           O 
ATOM    222  CB  ILE P  88    175.4029191.5122178.0853 1.00068.745           C 
ATOM    223 CG1  ILE P  88    176.0679192.2252179.2643 1.00068.745           C 
ATOM    224 CG2  ILE P  88    173.8879191.5792178.1973 1.00068.745           C 
ATOM    225 CD1  ILE P  88    176.0459193.7322179.1703 1.00068.745           C 
ATOM    226  H   ILE P  88    177.4089190.2892176.8303 1.00068.745           H 
ATOM    227  HA  ILE P  88    175.7669189.6682178.9083 1.00068.745           H 
ATOM    228  HB  ILE P  88    175.6719191.9532177.2663 1.00068.745           H 
ATOM    229 HG12 ILE P  88    175.6079191.9722180.0793 1.00068.745           H 
ATOM    230 HG13 ILE P  88    176.9949191.9462179.3153 1.00068.745           H 
ATOM    231 HG21 ILE P  88    173.6339192.4302178.5833 1.00068.745           H 
ATOM    232 HG22 ILE P  88    173.4989191.4952177.3123 1.00068.745           H 
ATOM    233 HG23 ILE P  88    173.5809190.8582178.7683 1.00068.745           H 
ATOM    234 HD11 ILE P  88    176.5279194.0992179.9273 1.00068.745           H 
ATOM    235 HD12 ILE P  88    176.4759194.0002178.3433 1.00068.745           H 
ATOM    236 HD13 ILE P  88    175.1279194.0412179.1833 1.00068.745           H 
ATOM    237  N   GLN P  89    174.1629188.3912177.5983 1.00072.166           N 
ATOM    238  CA  GLN P  89    173.3119187.5222176.7963 1.00072.166           C 
ATOM    239  C   GLN P  89    171.9229187.4132177.4163 1.00072.166           C 
ATOM    240  O   GLN P  89    170.9249187.7822176.7963 1.00072.166           O 
ATOM    241  CB  GLN P  89    173.9389186.1332176.6643 1.00072.166           C 
ATOM    242  CG  GLN P  89    175.1309186.0682175.7253 1.00072.166           C 
ATOM    243  CD  GLN P  89    174.7309186.1382174.2663 1.00072.166           C 
ATOM    244 OE1  GLN P  89    173.5559186.3012173.9383 1.00072.166           O 
ATOM    245 NE2  GLN P  89    175.7109186.0112173.3803 1.00072.166           N 
ATOM    246  H   GLN P  89    174.0469188.2992178.4443 1.00072.166           H 
ATOM    247  HA  GLN P  89    173.2119187.8952175.9083 1.00072.166           H 
ATOM    248 HB2  GLN P  89    174.2409185.8462177.5393 1.00072.166           H 
ATOM    249 HB3  GLN P  89    173.2689185.5182176.3313 1.00072.166           H 
ATOM    250 HG2  GLN P  89    175.7229186.8112175.9093 1.00072.166           H 
ATOM    251 HG3  GLN P  89    175.5979185.2312175.8673 1.00072.166           H 
ATOM    252 HE21 GLN P  89    176.5189185.8972173.6483 1.00072.166           H 
ATOM    253 HE22 GLN P  89    175.5369186.0422172.5393 1.00072.166           H 
ATOM    254  N   ASP P  94    167.0319191.1362185.2973 1.00080.477           N 
ATOM    255  CA  ASP P  94    166.6519192.4082185.8993 1.00080.477           C 
ATOM    256  C   ASP P  94    165.5979192.1892186.9813 1.00080.477           C 
ATOM    257  O   ASP P  94    165.8869192.3032188.1713 1.00080.477           O 
ATOM    258  CB  ASP P  94    166.1359193.3702184.8273 1.00080.477           C 
ATOM    259  CG  ASP P  94    165.7079194.7072185.3983 1.00080.477           C 
ATOM    260 OD1  ASP P  94    166.5569195.3972186.0003 1.00080.477           O 
ATOM    261 OD2  ASP P  94    164.5249195.0712185.2373 1.00080.477           O 
ATOM    262  HA  ASP P  94    167.4319192.8092186.3123 1.00080.477           H 
ATOM    263 HB2  ASP P  94    166.8459193.5342184.1883 1.00080.477           H 
ATOM    264 HB3  ASP P  94    165.3729192.9732184.3793 1.00080.477           H 
ATOM    265  N   TYR P  95    164.3769191.8702186.5603 1.00077.792           N 
ATOM    266  CA  TYR P  95    163.2879191.5752187.4803 1.00077.792           C 
ATOM    267  C   TYR P  95    162.3579190.5652186.8193 1.00077.792           C 
ATOM    268  O   TYR P  95    162.5529190.1712185.6663 1.00077.792           O 
ATOM    269  CB  TYR P  95    162.5319192.8482187.8753 1.00077.792           C 
ATOM    270  CG  TYR P  95    163.2629193.7212188.8653 1.00077.792           C 
ATOM    271 CD1  TYR P  95    163.1339193.5102190.2283 1.00077.792           C 
ATOM    272 CD2  TYR P  95    164.0739194.7612188.4383 1.00077.792           C 
ATOM    273 CE1  TYR P  95    163.7969194.3072191.1393 1.00077.792           C 
ATOM    274 CE2  TYR P  95    164.7409195.5622189.3393 1.00077.792           C 
ATOM    275  CZ  TYR P  95    164.5989195.3312190.6883 1.00077.792           C 
ATOM    276  OH  TYR P  95    165.2609196.1302191.5903 1.00077.792           O 
ATOM    277  H   TYR P  95    164.1539191.8172185.7323 1.00077.792           H 
ATOM    278  HA  TYR P  95    163.6459191.1752188.2873 1.00077.792           H 
ATOM    279 HB2  TYR P  95    162.3689193.3732187.0773 1.00077.792           H 
ATOM    280 HB3  TYR P  95    161.6889192.6002188.2833 1.00077.792           H 
ATOM    281 HD1  TYR P  95    162.5939192.8192190.5313 1.00077.792           H 
ATOM    282 HD2  TYR P  95    164.1719194.9182187.5283 1.00077.792           H 
ATOM    283 HE1  TYR P  95    163.7029194.1532192.0503 1.00077.792           H 
ATOM    284 HE2  TYR P  95    165.2819196.2552189.0393 1.00077.792           H 
ATOM    285  HH  TYR P  95    164.9719195.9852192.3653 1.00077.792           H 
ATOM    286  N   ALA P  96    161.3409190.1432187.5643 1.00078.981           N 
ATOM    287  CA  ALA P  96    160.3529189.2022187.0443 1.00078.981           C 
ATOM    288  C   ALA P  96    159.0939189.3182187.8843 1.00078.981           C 
ATOM    289  O   ALA P  96    159.1259189.0292189.0843 1.00078.981           O 
ATOM    290  CB  ALA P  96    160.8899187.7772187.0713 1.00078.981           C 
ATOM    291  H   ALA P  96    161.1979190.3892188.3753 1.00078.981           H 
ATOM    292  HA  ALA P  96    160.1379189.4332186.1283 1.00078.981           H 
ATOM    293 HB1  ALA P  96    160.2059187.1802186.7313 1.00078.981           H 
ATOM    294 HB2  ALA P  96    161.6819187.7302186.5143 1.00078.981           H 
ATOM    295 HB3  ALA P  96    161.1079187.5422187.9863 1.00078.981           H 
ATOM    296  N   ASP P  97    157.9929189.7352187.2563 1.00078.557           N 
ATOM    297  CA  ASP P  97    156.7049189.8522187.9203 1.00078.557           C 
ATOM    298  C   ASP P  97    155.5939189.0802187.2303 1.00078.557           C 
ATOM    299  O   ASP P  97    154.5859188.7782187.8773 1.00078.557           O 
ATOM    300  CB  ASP P  97    156.2859191.3262188.0183 1.00078.557           C 
ATOM    301  CG  ASP P  97    157.3469192.1922188.6703 1.00078.557           C 
ATOM    302 OD1  ASP P  97    158.1399191.6602189.4753 1.00078.557           O 
ATOM    303 OD2  ASP P  97    157.3889193.4062188.3793 1.00078.557           O 
ATOM    304  H   ASP P  97    157.9699189.9592186.4273 1.00078.557           H 
ATOM    305  HA  ASP P  97    156.7729189.5092188.8233 1.00078.557           H 
ATOM    306 HB2  ASP P  97    156.1259191.6662187.1243 1.00078.557           H 
ATOM    307 HB3  ASP P  97    155.4759191.3872188.5463 1.00078.557           H 
ATOM    308  N   GLU P  98    155.7439188.7562185.9463 1.00081.721           N 
ATOM    309  CA  GLU P  98    154.7579187.9462185.2443 1.00081.721           C 
ATOM    310  C   GLU P  98    154.9569186.4562185.4773 1.00081.721           C 
ATOM    311  O   GLU P  98    154.0119185.6822185.2913 1.00081.721           O 
ATOM    312  CB  GLU P  98    154.8159188.2342183.7423 1.00081.721           C 
ATOM    313  CG  GLU P  98    154.6889189.7042183.3793 1.00081.721           C 
ATOM    314  CD  GLU P  98    154.7529189.9412181.8843 1.00081.721           C 
ATOM    315 OE1  GLU P  98    154.5929188.9682181.1183 1.00081.721           O 
ATOM    316 OE2  GLU P  98    154.9669191.1012181.4743 1.00081.721           O 
ATOM    317  H   GLU P  98    156.4099188.9972185.4593 1.00081.721           H 
ATOM    318  HA  GLU P  98    153.8729188.1802185.5593 1.00081.721           H 
ATOM    319 HB2  GLU P  98    155.6669187.9212183.4003 1.00081.721           H 
ATOM    320 HB3  GLU P  98    154.0919187.7582183.3073 1.00081.721           H 
ATOM    321 HG2  GLU P  98    153.8369190.0372183.7023 1.00081.721           H 
ATOM    322 HG3  GLU P  98    155.4159190.1972183.7883 1.00081.721           H 
ATOM    323  N   GLU P  99    156.1569186.0382185.8813 1.00079.869           N 
ATOM    324  CA  GLU P  99    156.4539184.6282186.0953 1.00079.869           C 
ATOM    325  C   GLU P  99    155.8429184.0742187.3753 1.00079.869           C 
ATOM    326  O   GLU P  99    155.9879182.8732187.6313 1.00079.869           O 
ATOM    327  CB  GLU P  99    157.9679184.4172186.1223 1.00079.869           C 
ATOM    328  CG  GLU P  99    158.6669184.7832184.8223 1.00079.869           C 
ATOM    329  CD  GLU P  99    160.1319184.3862184.8123 1.00079.869           C 
ATOM    330 OE1  GLU P  99    160.5789183.7252185.7723 1.00079.869           O 
ATOM    331 OE2  GLU P  99    160.8359184.7332183.8403 1.00079.869           O 
ATOM    332  H   GLU P  99    156.8229186.5572186.0403 1.00079.869           H 
ATOM    333  HA  GLU P  99    156.0969184.1182185.3523 1.00079.869           H 
ATOM    334 HB2  GLU P  99    158.3429184.9722186.8223 1.00079.869           H 
ATOM    335 HB3  GLU P  99    158.1489183.4842186.3113 1.00079.869           H 
ATOM    336 HG2  GLU P  99    158.2269184.3282184.0883 1.00079.869           H 
ATOM    337 HG3  GLU P  99    158.6139185.7432184.6963 1.00079.869           H 
ATOM    338  N   VAL P 100    155.1749184.9032188.1793 1.00076.754           N 
ATOM    339  CA  VAL P 100    154.5759184.4802189.4363 1.00076.754           C 
ATOM    340  C   VAL P 100    153.1389184.9772189.4873 1.00076.754           C 
ATOM    341  O   VAL P 100    152.7629185.9412188.8183 1.00076.754           O 
ATOM    342  CB  VAL P 100    155.3669184.9932190.6573 1.00076.754           C 
ATOM    343 CG1  VAL P 100    156.6739184.2492190.7793 1.00076.754           C 
ATOM    344 CG2  VAL P 100    155.6249186.4932190.5503 1.00076.754           C 
ATOM    345  H   VAL P 100    155.0529185.7372188.0143 1.00076.754           H 
ATOM    346  HA  VAL P 100    154.5549183.5132189.4823 1.00076.754           H 
ATOM    347  HB  VAL P 100    154.8489184.8292191.4593 1.00076.754           H 
ATOM    348 HG11 VAL P 100    157.2839184.7682191.3243 1.00076.754           H 
ATOM    349 HG12 VAL P 100    156.5079183.3872191.1913 1.00076.754           H 
ATOM    350 HG13 VAL P 100    157.0479184.1312189.8943 1.00076.754           H 
ATOM    351 HG21 VAL P 100    156.0499186.7942191.3673 1.00076.754           H 
ATOM    352 HG22 VAL P 100    156.2129186.6642189.7983 1.00076.754           H 
ATOM    353 HG23 VAL P 100    154.7849186.9602190.4283 1.00076.754           H 
ATOM    354  N   ASP P 101    152.3329184.2962190.2983 1.00076.282           N 
ATOM    355  CA  ASP P 101    150.9309184.6712190.4633 1.00076.282           C 
ATOM    356  C   ASP P 101    150.4609184.1182191.8003 1.00076.282           C 
ATOM    357  O   ASP P 101    150.3719182.8982191.9663 1.00076.282           O 
ATOM    358  CB  ASP P 101    150.0849184.1382189.3153 1.00076.282           C 
ATOM    359  CG  ASP P 101    148.7099184.7762189.2533 1.00076.282           C 
ATOM    360 OD1  ASP P 101    148.1699185.1532190.3133 1.00076.282           O 
ATOM    361 OD2  ASP P 101    148.1669184.9002188.1363 1.00076.282           O 
ATOM    362  H   ASP P 101    152.5729183.6182190.7663 1.00076.282           H 
ATOM    363  HA  ASP P 101    150.8519185.6352190.4833 1.00076.282           H 
ATOM    364 HB2  ASP P 101    150.5369184.3232188.4783 1.00076.282           H 
ATOM    365 HB3  ASP P 101    149.9679183.1832189.4293 1.00076.282           H 
ATOM    366  N   VAL P 102    150.1629185.0082192.7413 1.00075.544           N 
ATOM    367  CA  VAL P 102    149.6369184.5842194.0283 1.00075.544           C 
ATOM    368  C   VAL P 102    148.1509184.2662193.8963 1.00075.544           C 
ATOM    369  O   VAL P 102    147.4929184.6242192.9163 1.00075.544           O 
ATOM    370  CB  VAL P 102    149.8839185.6562195.1053 1.00075.544           C 
ATOM    371 CG1  VAL P 102    151.3379186.0882195.1063 1.00075.544           C 
ATOM    372 CG2  VAL P 102    148.9769186.8472194.8893 1.00075.544           C 
ATOM    373  H   VAL P 102    150.2579185.8582192.6603 1.00075.544           H 
ATOM    374  HA  VAL P 102    150.0919183.7742194.3033 1.00075.544           H 
ATOM    375  HB  VAL P 102    149.6839185.2822195.9753 1.00075.544           H 
ATOM    376 HG11 VAL P 102    151.5109186.6032195.9083 1.00075.544           H 
ATOM    377 HG12 VAL P 102    151.9019185.3022195.0893 1.00075.544           H 
ATOM    378 HG13 VAL P 102    151.5059186.6322194.3233 1.00075.544           H 
ATOM    379 HG21 VAL P 102    149.3549187.6092195.3513 1.00075.544           H 
ATOM    380 HG22 VAL P 102    148.9179187.0302193.9393 1.00075.544           H 
ATOM    381 HG23 VAL P 102    148.0969186.6492195.2453 1.00075.544           H 
ATOM    382  N   VAL P 103    147.6219183.5772194.9053 1.00076.790           N 
ATOM    383  CA  VAL P 103    146.2059183.2562194.9963 1.00076.790           C 
ATOM    384  C   VAL P 103    145.7069183.7262196.3553 1.00076.790           C 
ATOM    385  O   VAL P 103    146.4869184.0842197.2373 1.00076.790           O 
ATOM    386  CB  VAL P 103    145.9289181.7522194.8003 1.00076.790           C 
ATOM    387 CG1  VAL P 103    146.6069181.2512193.5413 1.00076.790           C 
ATOM    388 CG2  VAL P 103    146.3899180.9562196.0083 1.00076.790           C 
ATOM    389  H   VAL P 103    148.0789183.2772195.5673 1.00076.790           H 
ATOM    390  HA  VAL P 103    145.7159183.7422194.3173 1.00076.790           H 
ATOM    391  HB  VAL P 103    144.9739181.6192194.6993 1.00076.790           H 
ATOM    392 HG11 VAL P 103    146.2799180.3612193.3403 1.00076.790           H 
ATOM    393 HG12 VAL P 103    146.3989181.8552192.8123 1.00076.790           H 
ATOM    394 HG13 VAL P 103    147.5649181.2272193.6883 1.00076.790           H 
ATOM    395 HG21 VAL P 103    146.5519180.0402195.7353 1.00076.790           H 
ATOM    396 HG22 VAL P 103    147.2079181.3492196.3503 1.00076.790           H 
ATOM    397 HG23 VAL P 103    145.6999180.9792196.6893 1.00076.790           H 
ATOM    398  N   PHE P 104    144.3869183.7192196.5163 1.00077.175           N 
ATOM    399  CA  PHE P 104    143.7679184.1982197.7433 1.00077.175           C 
ATOM    400  C   PHE P 104    142.5059183.4002198.0253 1.00077.175           C 
ATOM    401  O   PHE P 104    141.7449183.0822197.1083 1.00077.175           O 
ATOM    402  CB  PHE P 104    143.4409185.6902197.6503 1.00077.175           C 
ATOM    403  CG  PHE P 104    144.5879186.5812198.0153 1.00077.175           C 
ATOM    404 CD1  PHE P 104    144.7149187.0702199.3023 1.00077.175           C 
ATOM    405 CD2  PHE P 104    145.5419186.9292197.0753 1.00077.175           C 
ATOM    406 CE1  PHE P 104    145.7699187.8892199.6443 1.00077.175           C 
ATOM    407 CE2  PHE P 104    146.5979187.7472197.4143 1.00077.175           C 
ATOM    408  CZ  PHE P 104    146.7109188.2272198.6993 1.00077.175           C 
ATOM    409  H   PHE P 104    143.8259183.4422195.9273 1.00077.175           H 
ATOM    410  HA  PHE P 104    144.3759184.0702198.4863 1.00077.175           H 
ATOM    411 HB2  PHE P 104    143.1849185.8932196.7383 1.00077.175           H 
ATOM    412 HB3  PHE P 104    142.7069185.8862198.2513 1.00077.175           H 
ATOM    413 HD1  PHE P 104    144.0809186.8442199.9443 1.00077.175           H 
ATOM    414 HD2  PHE P 104    145.4699186.6072196.2063 1.00077.175           H 
ATOM    415 HE1  PHE P 104    145.8469188.2132200.5123 1.00077.175           H 
ATOM    416 HE2  PHE P 104    147.2329187.9742196.7753 1.00077.175           H 
ATOM    417  HZ  PHE P 104    147.4199188.7772198.9303 1.00077.175           H 
ATOM    418  N   THR P 105    142.2889183.1002199.3043 1.00080.945           N 
ATOM    419  CA  THR P 105    141.1339182.3322199.7603 1.00080.945           C 
ATOM    420  C   THR P 105    140.9829181.0252198.9893 1.00080.945           C 
ATOM    421  O   THR P 105    141.1029179.9412199.5603 1.00080.945           O 
ATOM    422  CB  THR P 105    139.8259183.1472199.6373 1.00080.945           C 
ATOM    423 OG1  THR P 105    139.6389183.5812198.2843 1.00080.945           O 
ATOM    424 CG2  THR P 105    139.8629184.3582200.5603 1.00080.945           C 
ATOM    425  H   THR P 105    142.8099183.3412199.9443 1.00080.945           H 
ATOM    426  HA  THR P 105    141.2589182.1112200.6953 1.00080.945           H 
ATOM    427  HB  THR P 105    139.0769182.5892199.8993 1.00080.945           H 
ATOM    428 HG1  THR P 105    139.6359182.9222197.7643 1.00080.945           H 
ATOM    429 HG21 THR P 105    139.0489184.8752200.4603 1.00080.945           H 
ATOM    430 HG22 THR P 105    139.9419184.0692201.4833 1.00080.945           H 
ATOM    431 HG23 THR P 105    140.6229184.9192200.3413 1.00080.945           H 
"""

__process_pdbs__(input)

# pdb_file_path = gettempdir() + 'test.pdb'
#
# with open(pdb_file_path, 'w') as f:
#     f.write(input)
#
# pdb_file = pdb.PDBFile.read(pdb_file_path)
# tc5b = pdb_file.get_structure()
#
# arr = tc5b.get_array(0)
#
# print(arr[arr.atom_name == 'CA'])